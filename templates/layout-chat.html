<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>{{ title }}</title>
<!-- BootstrapのCSS読み込み -->
<link href="/sp-service/static/css/bootstrap.min.css" rel="stylesheet">
<link href="/sp-service/static/css/style.css" rel="stylesheet">
<!-- <link href="/sp-service/static/css/navbar-fixed-left.min.css" rel="stylesheet"> -->
{{ head }}
</head>
<body>
<nav class="navbar navbar-expand-md navbar-dark bg-primary">
 <a class="navbar-brand" href="/sp-service">SP service</a>
</nav>
<div class="container-fluid max-hei">
<div class="row max-hei">
<nav class="col-md-2 bg-info max-hei">
<div class="sidebar-sticky max-hei">
<ul class="nav">
<li class="nav-item"><a class="nav-link text-light" href="/sp-service">Home</a></li>
<li class="nav-item"><a class="nav-link text-light" href="/sp-service/upload">File Upload</a></li>
<li class="nav-item"><a class="nav-link text-light" href="/sp-service/threads">BBS</a></li>
<li class="nav-item"><a class="nav-link text-light" href="/sp-service/contact">Contact</a></li>
<li class="nav-item"><a class="nav-link text-light" href="/sp-service/sp-user/mypage">MyPage</a></li>
<li class="nav-item"><a class="nav-link text-light" href="/sp-service/sp-user/signup">Signup</a></li>
<li class="nav-item"><a class="nav-link text-light" href="/sp-service/sp-user/login">Login</a></li>
<li class="nav-item"><a class="nav-link text-light" href="/sp-service/sp-user/logout">Logout</a></li>
</ul>
</div>
</nav>
<div class="col-md-10">
{% block content %}
{% endblock %}
</div>
</div>
<!--<footer class="fixed-bottom bg-secondary">-->
<!--<div class="container">-->
<!--<div class="text-light">Powered by <a class="text-dark" href="https://www.python.org">Python</a> and <a class="text-dark" href="https://a2c.bitbucket.io/flask/">Flask</a></div>-->
<!--<div class="text-light">Copyright (C) 2019-<span id="thisYear"></span> SP-Service Foundation</div>-->
<!--</div>-->
<!--</footer>-->
<script src="/sp-service/static/js/jquery-3.4.1.min.js"></script>
<script src="/sp-service/static/js/bootstrap.min.js"></script>
<script src="/sp-service/static/js/script.js"></script>
<script nonce="ZWMyNjQ3YzMyNDI5ODI5MWQ0ODE1NjlkY2UxODAzODc2ZGUzYWQ2OA">
var scheme = "wss://";
var url = scheme + "mypcnotes.mydns.jp/chat";
var ws = new WebSocket(url);

ws.onopen = function(){
        ws.send('{{user[0][2]}} is joined.');
};

ws.onmessage = function(message){
        $("#chat-text").prepend('<div class="card card-{{user[0][4]}}"><div class="card-heading">{{user[0][2]}}</div><div class="card-body">'+message.data+'</div></div><br/>');
};

ws.onerror = function(){
        $("#chat-text").prepend('<div class="card card-{{user[0][4]}}"><div class="card-heading">{{user[0][2]}}</div><div class="card-body">error</div></div><br/>');
};

ws.onclose = function(){
        $("#chat-text").prepend('<div class="card card-{{user[0][2]}}"><div class="card-heading">{{user[0][2]}}</div><div class="card-body">{{user[0][2]}} is leave.</div></div><br/>');
};

$(window).on('unload', function() {
        ws.onclose();
});

$("#input-form").on("submit",function(event) {
	event.preventDefault();
	var text = $("#input-text")[0].value;
	ws.send(text);
	$("#input-text")[0].value = "";
});

</script>
</body>
</html>
